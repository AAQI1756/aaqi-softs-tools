<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Dancing+Script:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .certificate-canvas {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
        }
    </style>
</head>

<body class="p-4 sm:p-8 flex flex-col items-center min-h-screen">
    <div class="max-w-4xl w-full bg-white rounded-xl shadow-2xl p-6 sm:p-10 mb-8">
        <div class="flex flex-col sm:flex-row items-center justify-between mb-8">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 text-center sm:text-left mb-4 sm:mb-0">
                Create a Certificate
            </h1>
            <svg class="w-16 h-16 sm:w-20 sm:h-20 text-blue-500 animate-bounce" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                <path d="M16 12l-4-4v3H8v2h4v3l4-4z"/>
            </svg>
        </div>

        <!-- Input Form -->
        <form id="certificate-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="col-span-1">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Recipient Name</label>
                <input type="text" id="username" placeholder="e.g. John Doe" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
            <div class="col-span-1">
                <label for="courseName" class="block text-sm font-medium text-gray-700 mb-1">Course Name</label>
                <input type="text" id="courseName" placeholder="e.g. Web Development Fundamentals" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
            <div class="col-span-1">
                <label for="academyName" class="block text-sm font-medium text-gray-700 mb-1">Academy/Institute Name</label>
                <input type="text" id="academyName" placeholder="e.g. AAQI Soft Solutions" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
            <div class="col-span-1">
                <label for="signatureName" class="block text-sm font-medium text-gray-700 mb-1">Signature Person Name</label>
                <input type="text" id="signatureName" placeholder="e.g. Muhammad Asadullah" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
            <div class="col-span-1">
                <label for="duration" class="block text-sm font-medium text-gray-700 mb-1">Course Duration</label>
                <select id="duration" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
                    <option value="">Select duration</option>
                    <option value="1">1 Month</option>
                    <option value="3">3 Months</option>
                    <option value="6">6 Months</option>
                    <option value="12">1 Year</option>
                </select>
            </div>
            <div class="col-span-1">
                <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                <input type="date" id="startDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
            <div class="col-span-1">
                <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                <input type="text" id="endDate" readonly class="w-full px-4 py-2 bg-gray-100 text-gray-500 border border-gray-300 rounded-lg cursor-not-allowed">
            </div>
            <div class="col-span-1">
                <label for="issueDate" class="block text-sm font-medium text-gray-700 mb-1">Issue Date</label>
                <input type="date" id="issueDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" required>
            </div>
        </form>

        <div class="flex justify-center mt-8">
            <button id="generate-btn" class="px-8 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 pulse-animation">
                Generate Certificate
            </button>
        </div>
    </div>

    <!-- Certificate Preview Section -->
    <div id="certificate-preview" class="w-full max-w-4xl relative" style="display:none;">
        <canvas id="certificate-canvas" class="certificate-canvas w-full h-auto"></canvas>
        <div class="flex justify-center mt-4">
            <button id="download-btn" class="px-8 py-3 bg-green-500 text-white font-bold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                Download Certificate
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const usernameInput = document.getElementById('username');
            const courseNameInput = document.getElementById('courseName');
            const academyNameInput = document.getElementById('academyName');
            const signatureNameInput = document.getElementById('signatureName');
            const durationSelect = document.getElementById('duration');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const issueDateInput = document.getElementById('issueDate');
            const generateBtn = document.getElementById('generate-btn');
            const downloadBtn = document.getElementById('download-btn');
            const certificatePreview = document.getElementById('certificate-preview');
            const canvas = document.getElementById('certificate-canvas');
            const ctx = canvas.getContext('2d');

            // Set today's date as default for issue date
            const today = new Date().toISOString().split('T')[0];
            issueDateInput.value = today;

            // Calculate and display the end date based on start date and duration
            const updateEndDate = () => {
                const startDate = startDateInput.value;
                const duration = durationSelect.value;
                if (startDate && duration) {
                    const start = new Date(startDate);
                    start.setMonth(start.getMonth() + parseInt(duration, 10));
                    endDateInput.value = start.toISOString().split('T')[0];
                } else {
                    endDateInput.value = '';
                }
            };
            startDateInput.addEventListener('change', updateEndDate);
            durationSelect.addEventListener('change', updateEndDate);

            const formatDate = (dateString) => {
                const date = new Date(dateString.split('T')[0]);
                if (isNaN(date.getTime())) {
                    return 'Invalid Date';
                }
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            };

            // Function to draw the certificate on the canvas
            const drawCertificate = (username, course, academy, signature, start, end, issue, certId, qrCodeImage) => {
                const width = 1000;
                const height = 707;
                canvas.width = width;
                canvas.height = height;

                ctx.clearRect(0, 0, width, height);

                // Background
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#f8fafc');
                gradient.addColorStop(1, '#e2e8f0');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);

                // Title
                ctx.fillStyle = '#1e293b';
                ctx.font = '700 60px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Certificate of Completion', width / 2, 120);

                // Certificate ID
                ctx.font = '500 14px Inter';
                ctx.textAlign = 'left';
                ctx.fillStyle = '#64748b';
                ctx.fillText(`ID: ${certId}`, 60, 60);

                // Presented to text
                ctx.fillStyle = '#1e293b';
                ctx.font = '500 24px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('This is to certify that', width / 2, 200);

                // Recipient Name
                ctx.fillStyle = '#3b82f6';
                ctx.font = '700 48px Inter';
                ctx.fillText(username, width / 2, 280);

                // Course and Dates
                ctx.fillStyle = '#1e293b';
                ctx.font = '500 22px Inter';
                ctx.fillText(`has successfully completed the course on`, width / 2, 350);

                ctx.font = '700 30px Inter';
                ctx.fillText(course, width / 2, 400);

                // Honor text
                ctx.font = '400 20px Inter';
                ctx.fillText(`in recognition of their outstanding achievement`, width / 2, 435);
                
                // Dates and Issue Date
                ctx.font = '500 20px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`from ${formatDate(start.toISOString())} to ${formatDate(end.toISOString())}`, width / 2, 470);
                
                ctx.font = '500 18px Inter';
                ctx.fillText(`This certificate is issued on ${formatDate(issue.toISOString())}`, width / 2, 500);

                // Signature
                ctx.font = '400 30px "Dancing Script"';
                ctx.textAlign = 'right';
                ctx.fillText(signature, width - 60, height - 130);
                
                ctx.font = '600 20px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(academy, width - 60, height - 90);

                // Draw QR Code
                const qrSize = 120;
                ctx.drawImage(qrCodeImage, 60, height - qrSize - 40, qrSize, qrSize);
            };

            // Generate the QR code and certificate
            generateBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const username = usernameInput.value;
                const courseName = courseNameInput.value;
                const academyName = academyNameInput.value;
                const signatureName = signatureNameInput.value;
                const startDate = startDateInput.value;
                const endDate = endDateInput.value;
                const issueDate = issueDateInput.value;

                if (!username || !courseName || !academyName || !signatureName || !startDate || !endDate || !issueDate) {
                    // Custom message box to replace alert()
                    const messageBox = document.createElement('div');
                    messageBox.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
                    messageBox.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                            <p class="text-lg font-semibold mb-4">Please fill out all fields.</p>
                            <button id="close-message" class="px-4 py-2 bg-blue-500 text-white rounded-lg">OK</button>
                        </div>
                    `;
                    document.body.appendChild(messageBox);
                    document.getElementById('close-message').addEventListener('click', () => {
                        messageBox.remove();
                    });
                    return;
                }

                // Generate a unique 8-digit random ID
                const certId = `${Math.floor(10000000 + Math.random() * 90000000)}`;
                
                // Data for the QR code - simplified for better scanning
                const qrData = `ID: ${certId}|Recipient: ${username}|Course: ${courseName}|Academy: ${academyName}`;

                // Use a temporary div to generate the QR code as a canvas
                const tempQrDiv = document.createElement('div');
                new QRCode(tempQrDiv, {
                    text: qrData,
                    width: 256,
                    height: 256,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Wait for the QR code to be generated
                setTimeout(() => {
                    const qrCanvas = tempQrDiv.querySelector('canvas');
                    if (!qrCanvas) {
                        return;
                    }
                    const qrImage = new Image();
                    qrImage.src = qrCanvas.toDataURL();
                    qrImage.onload = () => {
                        drawCertificate(
                            username,
                            courseName,
                            academyName,
                            signatureName,
                            new Date(startDate),
                            new Date(endDate),
                            new Date(issueDate),
                            certId,
                            qrImage
                        );
                        certificatePreview.style.display = 'block';
                        // Scroll to the certificate preview
                        certificatePreview.scrollIntoView({ behavior: 'smooth' });
                    };
                }, 100);
            });

            // Download the certificate as a PNG
            downloadBtn.addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `${usernameInput.value}_certificate.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });
    </script>
</body>

</html>
